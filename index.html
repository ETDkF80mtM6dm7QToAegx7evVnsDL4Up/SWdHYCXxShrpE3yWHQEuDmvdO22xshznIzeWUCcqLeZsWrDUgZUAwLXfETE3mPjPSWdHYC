<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Amuthu AI - Register</title>
<style>
  /* Body & card */
  body {
    margin:0;
    padding:0;
    font-family: 'Poppins', sans-serif;
    background: linear-gradient(135deg,#171717,#1a1a1a);
    display:flex;
    justify-content:center;
    align-items:center;
    height:100vh;
    overflow:hidden; /* unscrollable */
    user-select:none; /* prevent selection */
  }

  .card {
    background:#222;
    border-radius:20px;
    padding:30px 20px 40px 20px;
    width:90%;
    max-width:400px;
    text-align:center;
    position:relative;
  }

  /* Logo */
  .logo {
    width:120px;
    height:120px;
    border-radius:50%;
    object-fit:cover;
    border:3px solid #444;
    transition:.3s;
    margin-top:-80px;
    margin-bottom:20px;
  }
  .logo:hover{
    transform:scale(1.05);
    box-shadow:0 0 10px #0cf;
  }

  h2 {
    color:#0cf;
    margin-bottom:15px;
  }

  /* Form */
  form { display:flex; flex-direction:column; gap:12px; }
  input {
    padding:12px;
    border-radius:8px;
    border:none;
    background:#333;
    color:white;
  }
  button {
    padding:12px;
    border:none;
    border-radius:8px;
    background:#0cf;
    color:white;
    font-weight:600;
    cursor:pointer;
    margin-top:10px;
  }
  button:hover { background:#09f; }

  /* Popup */
  .popup {
    position:fixed;
    top:50%; left:50%;
    transform:translate(-50%,-50%);
    background:rgba(0,0,0,0.95);
    color:white;
    padding:20px 25px;
    border-radius:12px;
    display:none;
    z-index:9999;
    text-align:center;
  }

  /* Loader overlay */
  .overlay {
    position:fixed;
    inset:0;
    background:rgba(0,0,0,0.6);
    display:none;
    justify-content:center;
    align-items:center;
    z-index:9998;
  }
  .spinner {
    width:50px; height:50px;
    border:5px solid #444;
    border-top-color:#0cf;
    border-radius:50%;
    animation:spin 1s linear infinite;
  }
  @keyframes spin { to { transform:rotate(360deg); } }
</style>
</head>
<body>

<div class="overlay" id="loaderOverlay">
  <div class="spinner"></div>
</div>

<div class="popup" id="popupMsg"></div>

<div class="card" id="registerCard">
  <img src="https://raw.githubusercontent.com/ETDkF80mtM6dm7QToAegx7evVnsDL4Up/SWdHYCXxShrpE3yWHQEuDmvdO22xshznIzeWUCcqLeZsWrDUgZUAwLXfETE3mPjPSWdHYC/refs/heads/main/unnamed.png" class="logo" alt="Amuthu AI">
  <h2>Register to Amuthu AI</h2>
  <form id="regForm">
    <input type="file" accept="image/*" id="profilePic" required>
    <input type="text" placeholder="Username" id="username" required>
    <input type="email" placeholder="Email" id="email" required>
    <input type="password" placeholder="Password" id="password" required>
    <input type="password" placeholder="Confirm Password" id="confirmPassword" required>
    <button type="submit">Register</button>
  </form>
</div>

<script>
  // Disable right click
  document.addEventListener('contextmenu', e=>e.preventDefault());
  // Disable keys: F12, Ctrl+Shift+I/J/C, Ctrl+U
  document.addEventListener('keydown', e=>{
    if(e.key==='F12' || (e.ctrlKey && e.shiftKey && ['I','J','C'].includes(e.key.toUpperCase())) || (e.ctrlKey && e.key==='u')) {
      e.preventDefault();
    }
  });

  const regForm = document.getElementById('regForm');
  const loader = document.getElementById('loaderOverlay');
  const popup = document.getElementById('popupMsg');
  const registerCard = document.getElementById('registerCard');

  // On load: check if user exists
  window.addEventListener('load', ()=>{
    const user = localStorage.getItem('amuthuUser');
    if(user){ window.location.href='bot.html'; }
  });

  // Convert image to base64
  function imgToBase64(file){
    return new Promise((resolve,reject)=>{
      const reader = new FileReader();
      reader.onload = ()=>resolve(reader.result.split(',')[1]); // remove data:image/... prefix
      reader.onerror=reject;
      reader.readAsDataURL(file);
    });
  }

  function showLoader(show=true){ loader.style.display=show?'flex':'none'; }
  function showPopup(msg, duration=2000){
    popup.innerText = msg;
    popup.style.display='block';
    setTimeout(()=>popup.style.display='none', duration);
  }

  regForm.addEventListener('submit', async e=>{
    e.preventDefault();
    const file = document.getElementById('profilePic').files[0];
    const username = document.getElementById('username').value.trim();
    const email = document.getElementById('email').value.trim();
    const password = document.getElementById('password').value;
    const confirmPassword = document.getElementById('confirmPassword').value;

    if(password!==confirmPassword){
      showPopup('Passwords do not match!');
      return;
    }
    showLoader(true);
    try{
      const avatar_b64 = await imgToBase64(file);
      // Save to localStorage
      const userData = { username,email,password,avatar_b64,created_at:new Date().toISOString() };
      localStorage.setItem('amuthuUser', JSON.stringify(userData));
      setTimeout(()=>{
        showLoader(false);
        showPopup('Registered successfully! Redirecting...', 1500);
        setTimeout(()=> window.location.href='bot.html',1500);
      },1000);
    }catch(err){
      console.error(err);
      showLoader(false);
      showPopup('Failed to process image');
    }
  });

</script>
</body>
</html>
